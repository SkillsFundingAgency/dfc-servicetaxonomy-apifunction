{
  "query": "with toLower($label) as lowerlabel call db.index.fulltext.queryNodes(\"OccupationLabels\", \"skos__prefLabel:\"+lowerlabel) yield node, score match (node)-[:ncs__hasPrefLabel]-(po:esco__Occupation) with collect({Occupation:po, Score:score * 2, PrefLabels:node}) as prefocc, lowerlabel call db.index.fulltext.queryNodes(\"OccupationLabels\", \"skos__prefLabel:\"+lowerlabel) yield node, score optional match (node)-[:ncs__hasAltLabel]-(ao:esco__Occupation) with lowerlabel, {Occupations: case toLower($matchaltlabels) when 'true' then prefocc + collect({Occupation:ao, Score:score, AltLabels:node}) when 'false' then prefocc end } as combocc unwind combocc.Occupations as o with distinct o, lowerlabel with { occupations:collect( { uri:o.Occupation.uri, occupation:o.Occupation.skos__prefLabel, alternativeLabels:o.Occupation.skos__altLabel, lastModified:o.Occupation.dct__modified, matches: { occupation:[preflab in o.PrefLabels.skos__prefLabel where toLower(preflab) contains lowerlabel], alternativeLabels:[altlab in o.AltLabels.skos__prefLabel where toLower(altlab) contains lowerlabel] }, score:o.Score } )} as occupations return occupations",
  "queryParams": [
    {
      "name": "label"
    },
    {
      "name": "matchaltlabels",
      "default": "false"
    }
  ]
}